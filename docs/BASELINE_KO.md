# network_system 성능 기준선

> **Language:** [English](BASELINE.md) | **한국어**

**Phase**: 0 - Foundation and Tooling
**Task**: 0.2 - Baseline Performance Benchmarking
**생성일**: 2025-10-07
**상태**: 인프라 완료 - 측정 대기 중

---

## 요약

이 문서는 network_system의 성능 기준선을 기록하며, 메시지 처리량, 연결 관리 및 세션 처리에 초점을 맞춥니다. 주요 목표는 고성능 네트워킹 운영을 위한 기준 메트릭을 설정하는 것입니다.

**기준선 측정 상태**: ⏳ 대기 중
- 인프라 완료 (벤치마크 구현됨)
- 측정 준비 완료
- CI 워크플로우 구성됨

---

## 목표 메트릭

### 주요 성공 기준

| 카테고리 | 메트릭 | 목표 | 허용 범위 |
|----------|--------|--------|------------|
| 메시지 연산 | 생성 (1KB) | < 1μs | < 10μs |
| 메시지 연산 | 직렬화 (1KB) | < 500ns | < 5μs |
| 메시지 연산 | 처리량 | > 100k msg/s | > 50k msg/s |
| 연결 | 생성 | < 1μs | < 10μs |
| 연결 | 설정 | < 100μs | < 1ms |
| 연결 | 전송 (1KB) | < 10μs | < 100μs |
| 세션 | 생성 | < 1μs | < 10μs |
| 세션 | 조회 | < 100ns | < 1μs |
| 세션 | 정리 (100개 세션) | < 100μs | < 1ms |

---

## 기준선 메트릭

### 1. 메시지 처리량 성능

| 테스트 케이스 | 목표 | 측정값 | 상태 |
|-----------|--------|----------|--------|
| 메시지 생성 (64B) | < 100ns | TBD | ⏳ |
| 메시지 생성 (1KB) | < 1μs | TBD | ⏳ |
| 메시지 생성 (64KB) | < 10μs | TBD | ⏳ |
| 메시지 복사 (64B) | < 100ns | TBD | ⏳ |
| 메시지 복사 (1KB) | < 500ns | TBD | ⏳ |
| 메시지 복사 (4KB) | < 2μs | TBD | ⏳ |
| 메시지 복사 (64KB) | < 30μs | TBD | ⏳ |
| 메시지 이동 (64B) | < 50ns | TBD | ⏳ |
| 메시지 이동 (1KB) | < 100ns | TBD | ⏳ |
| 메시지 이동 (64KB) | < 200ns | TBD | ⏳ |
| 직렬화 (64B) | < 100ns | TBD | ⏳ |
| 직렬화 (1KB) | < 500ns | TBD | ⏳ |
| 직렬화 (64KB) | < 30μs | TBD | ⏳ |
| 역직렬화 (64B) | < 100ns | TBD | ⏳ |
| 역직렬화 (1KB) | < 500ns | TBD | ⏳ |
| 역직렬화 (64KB) | < 30μs | TBD | ⏳ |
| 큐 push/pop | < 200ns | TBD | ⏳ |
| 버스트 처리 (10개 메시지) | < 10μs | TBD | ⏳ |
| 버스트 처리 (100개 메시지) | < 100μs | TBD | ⏳ |
| 버스트 처리 (1000개 메시지) | < 1ms | TBD | ⏳ |
| 지속 처리량 (1KB) | > 100k/s | TBD | ⏳ |
| 동시 처리 (4 스레드) | TBD | TBD | ⏳ |
| 동시 처리 (8 스레드) | TBD | TBD | ⏳ |

### 2. 연결 관리 성능

| 테스트 케이스 | 목표 | 측정값 | 상태 |
|-----------|--------|----------|--------|
| 연결 생성 | < 1μs | TBD | ⏳ |
| 연결 설정 | < 100μs | TBD | ⏳ |
| 연결 라이프사이클 | < 150μs | TBD | ⏳ |
| 풀 생성 (5개 연결) | < 500μs | TBD | ⏳ |
| 풀 생성 (10개 연결) | < 1ms | TBD | ⏳ |
| 풀 생성 (20개 연결) | < 2ms | TBD | ⏳ |
| 풀 생성 (50개 연결) | < 5ms | TBD | ⏳ |
| 풀 전체 연결 (5개 연결) | < 500μs | TBD | ⏳ |
| 풀 전체 연결 (10개 연결) | < 1ms | TBD | ⏳ |
| 풀 전체 연결 (20개 연결) | < 2ms | TBD | ⏳ |
| 풀 전체 연결 (50개 연결) | < 5ms | TBD | ⏳ |
| 전송 (64B) | < 5μs | TBD | ⏳ |
| 전송 (1KB) | < 10μs | TBD | ⏳ |
| 전송 (4KB) | < 30μs | TBD | ⏳ |
| 전송 (64KB) | < 500μs | TBD | ⏳ |
| 버스트 전송 (10개 메시지, 1KB) | < 100μs | TBD | ⏳ |
| 버스트 전송 (100개 메시지, 1KB) | < 1ms | TBD | ⏳ |
| 버스트 전송 (1000개 메시지, 1KB) | < 10ms | TBD | ⏳ |
| 상태 확인 | < 10ns | TBD | ⏳ |
| 동시 작업 (4 스레드) | TBD | TBD | ⏳ |
| 동시 작업 (8 스레드) | TBD | TBD | ⏳ |
| 동시 작업 (16 스레드) | TBD | TBD | ⏳ |
| 연결 재사용 | < 10μs | TBD | ⏳ |

### 3. 세션 관리 성능

| 테스트 케이스 | 목표 | 측정값 | 상태 |
|-----------|--------|----------|--------|
| 세션 생성 | < 1μs | TBD | ⏳ |
| 세션 관리자 생성 | < 2μs | TBD | ⏳ |
| 세션 생성/파괴 | < 3μs | TBD | ⏳ |
| 세션 데이터 설정 | < 500ns | TBD | ⏳ |
| 세션 데이터 가져오기 | < 200ns | TBD | ⏳ |
| 세션 조회 | < 100ns | TBD | ⏳ |
| 다수 세션 (10개) | < 10μs | TBD | ⏳ |
| 다수 세션 (100개) | < 100μs | TBD | ⏳ |
| 다수 세션 (1000개) | < 1ms | TBD | ⏳ |
| 다수 조회 (10개 세션) | < 100ns | TBD | ⏳ |
| 다수 조회 (100개 세션) | < 200ns | TBD | ⏳ |
| 다수 조회 (1000개 세션) | < 500ns | TBD | ⏳ |
| 정리 (100개 세션) | < 100μs | TBD | ⏳ |
| 활동 업데이트 | < 50ns | TBD | ⏳ |
| 동시 액세스 (4 스레드) | TBD | TBD | ⏳ |
| 동시 액세스 (8 스레드) | TBD | TBD | ⏳ |
| 동시 액세스 (16 스레드) | TBD | TBD | ⏳ |

---

## 플랫폼별 기준선

### macOS (Apple Silicon)

| 컴포넌트 | 메트릭 | 측정값 | 비고 |
|-----------|--------|----------|-------|
| 메시지 생성 (1KB) | TBD | TBD | |
| 연결 설정 | TBD | TBD | |
| 세션 조회 | TBD | TBD | |
| 처리량 (1KB 메시지) | TBD | TBD | |

### Ubuntu 22.04 (x86_64)

| 컴포넌트 | 메트릭 | 측정값 | 비고 |
|-----------|--------|----------|-------|
| 메시지 생성 (1KB) | TBD | TBD | |
| 연결 설정 | TBD | TBD | |
| 세션 조회 | TBD | TBD | |
| 처리량 (1KB 메시지) | TBD | TBD | |

---

## 벤치마크 실행 방법

```bash
cd network_system
cmake -B build -S . -DNETWORK_BUILD_BENCHMARKS=ON -DCMAKE_BUILD_TYPE=Release
cmake --build build
./build/benchmarks/network_benchmarks
```

### JSON 출력 생성

```bash
./build/benchmarks/network_benchmarks \
  --benchmark_format=json \
  --benchmark_out=results.json \
  --benchmark_repetitions=10
```

### 특정 카테고리 실행

```bash
# 메시지 처리량만
./build/benchmarks/network_benchmarks --benchmark_filter=Message

# 연결만
./build/benchmarks/network_benchmarks --benchmark_filter=Connection

# 세션만
./build/benchmarks/network_benchmarks --benchmark_filter=Session
```

---

## 성능 개선 기회

### 식별된 최적화 영역 (Phase 1+)

1. **메시지 연산**
   - 제로카피 메시지 전달
   - 빈번한 할당을 위한 메모리 풀
   - SIMD 가속 직렬화
   - 메시지 버퍼용 맞춤형 할당자

2. **연결 관리**
   - 락프리 연결 풀
   - 연결 사전 워밍
   - 적응형 풀 크기 조정
   - 연결 재사용 최적화

3. **세션 관리**
   - 락프리 세션 조회 (해시 맵)
   - 세션 데이터 캐시 지역성
   - 지연 세션 정리
   - 동시성을 위한 세션 샤딩

4. **일반**
   - 벡터화된 데이터 연산
   - 예측 가능한 액세스 패턴에 대한 프리페칭
   - 코루틴 기반 비동기 연산
   - NUMA 인식 메모리 할당

---

## 회귀 테스트

### CI/CD 통합

벤치마크는 다음에서 자동으로 실행됩니다:
- main/phase-* 브랜치에 대한 모든 push
- 모든 pull request
- 수동 워크플로우 디스패치

### 회귀 임계값

| 메트릭 유형 | 경고 임계값 | 실패 임계값 |
|-------------|-------------------|-------------------|
| 지연시간 증가 | +10% | +25% |
| 처리량 감소 | -10% | -25% |
| 메모리 사용량 증가 | +15% | +30% |

---

## 참고 사항

### 측정 조건

- **빌드 유형**: Release (-O3 최적화)
- **컴파일러**: Clang (최신 안정 버전)
- **CPU 주파수**: 고정 (Linux에서 성능 거버너)
- **반복**: 최소 3회 실행, 집계 보고
- **최소 시간**: 안정성을 위해 벤치마크당 5초

### 알려진 제한 사항

- 벤치마크 결과는 시스템 부하에 따라 달라질 수 있음
- 모의 객체 사용 (실제 네트워크 I/O 없음)
- 연결 설정은 10μs 오버헤드 시뮬레이션
- 세션 정리 테스트는 만료된 세션만 테스트

### 향후 개선사항

- 실제 네트워크 소켓 벤치마크 추가
- SSL/TLS 핸드셰이크 오버헤드 측정
- 압축/압축 해제 벤치마크 추가
- 프로토콜별 벤치마크 추가 (HTTP, WebSocket)

---

**마지막 업데이트**: 2025-10-07
**상태**: 인프라 완료
**다음 조치**: Google Benchmark 설치 및 측정 실행
